from posixpath import split

from PIL import Image
from PIL import ImageChops
from PIL import ImageStat as stat
import  numpy as np
from numpy.ma.core import asarray
import matplotlib.pyplot as plt

obrazek = Image.open("Inicjały.bmp")
obrazek.save("Inincjaly.png")
x = Image.open("Inincjaly.png")
beksinski = Image.open("beksinski.png")
print("beksinski tryb", beksinski.mode)
print("beksinski format", beksinski.format)
print("beksinski rozmiar", beksinski.size)
im = Image.open("kolorowe_cos.png")
print("tryb", im.mode)
print("format", im.format)
print("rozmiar", im.size)
im_tab = asarray(im)
print("typ danych tablicy:", im_tab.dtype)  # typ danych przechowywanych w tablicy
print("rozmiar tablicy:", im_tab.shape)

#zad3
t_r = im_tab[:, :, 0]
im_r = Image.fromarray(t_r)
t_g = im_tab[:, :, 1]
im_g = Image.fromarray(t_g)
t_b = im_tab[:, :, 2]
im_b = Image.fromarray(t_b)
im1 = Image.merge("RGB", (im_r,im_g,im_b))
plt.figure(figsize=(4,4))
plt.subplot(1,2,1)
plt.imshow(im)
plt.axis('off')
plt.subplot(1,2,2)
plt.imshow(im1)
plt.axis('off')
plt.subplots_adjust(wspace=0.05, hspace=0.05)
plt.savefig("figura1.png")
#plt.show()
#zad1
def rysuj_histogram_RGB(obraz):
    hist = obraz.histogram()
    plt.title("histogram  ")
    plt.bar(range(256), hist[:256], color='r', alpha=0.5)
    plt.bar(range(256), hist[256:2 * 256], color='g', alpha=0.4)
    plt.bar(range(256), hist[2 * 256:], color='b', alpha=0.3)
    plt.show()
#rysuj_histogram_RGB(im)
def zlicz_piksele(obraz, kolor):
    hist = obraz.histogram()
    print("kanał r:")
    print("kanał g:")
    print("kanał b:")

def wstaw_obraz_w_obraz(obraz_bazowy, obraz_wstawiany, m, n):
    tab_bazowy = np.asarray(obraz_bazowy).astype(np.int_)
    tab_wstawiany = np.asarray(obraz_wstawiany).astype(np.int_)
    h_bazowy, w_bazowy = tab_bazowy.shape
    h_wstawiany, w_wstawiany = tab_wstawiany.shape
    n_p= max(0, n)
    m_p = max(0, m)
    n_k = min(h_bazowy, n + h_wstawiany)
    m_k = min(w_bazowy, m + w_wstawiany)
    for i in range(n_p, n_k):
        for j in range(m_p, m_k):
            tab_bazowy[i, j] = tab_wstawiany[i - n, j - m]

    tab_wynik = tab_bazowy.astype(bool)

    return Image.fromarray(tab_wynik)
def koloruj_obraz(obraz, kolor):
    t_obraz = np.asarray(obraz)
    h, w = t_obraz.shape
    t =(h, w, 3)
    tab = np.ones(t, dtype=np.uint8)
    for i in range(h):
        for j in range(w):
            if t_obraz[i, j] == False:
                tab[i, j] = kolor
            else:
                tab[i, j] = [255, 255, 255]
    return Image.fromarray(tab)
def wstaw_obraz(w, h, m, n, obraz): # w,h rozmiary nowego obrazu, m<=w,  n<=h (m,n miejsce wstawienia obrazu )
    tab_obraz = np.asarray(obraz).astype(np.int_)
    h0, w0 = tab_obraz.shape
    t = (h, w)  # rozmiar tablicy nowego obrazu
    tab = np.zeros(t, dtype=np.uint8)  # deklaracja tablicy wypełnionej zerami - czarna
    n_k = min(h, n + h0) # jesli wstawiany obraz wychodzi poza ramy nowego obrazu, to przycinamy
    m_k = min(w, m + w0) # jesli wstawiany obraz wychodzi poza ramy nowego obrazu, to przycinamy
    n_p = max(0, n) # jesli miejsce wstawienia jest ujemne(wychodzi poza nowy obraz w górę), to przycinamy
    m_p = max(0, m) # jesli miejsce wstawienia jest ujemne(wychodzi poza nowy obraz w lewo), to przycinamy
    for i in range(n_p, n_k):
        for j in range(m_p, m_k):
            tab[i][j] = tab_obraz[i - n][j - m]
    tab = tab.astype(bool) # zapisanie tablicy w typie bool (obrazy czarnobiałe)
    return Image.fromarray(tab)

def wstaw_inicjaly(obraz_bazowy, obraz_wstawiony, m, n, kolor):
    tab_bazowy = np.asarray(obraz_bazowy)
    tab_wstawiony = np.asarray(obraz_wstawiony)
    h, w = tab_wstawiony.shape
    t = (h, w, 3)
    tab = np.ones(t, dtype=np.uint8)
    tab1 = np.ones(t, dtype=np.uint8)
    for i in range(h):
        for j in range(w):
            if tab_wstawiony[i, j] == False:
                tab[i, j] = kolor
                tab1[i, j] = kolor
            else:
                tab[i, j] = [255, 255, 255]
    ob_p_w = Image.fromarray(tab)
    tab_p_w = np.asarray(ob_p_w).astype(np.int_)
    h_bazowy, w_bazowy, t_bazowy = tab_bazowy.shape
    h_wstawiany, w_wstawiany, t_wstawiony = tab_p_w.shape
    n_p = max(0, n)
    m_p = max(0, m)
    n_k = min(h_bazowy, n + h_wstawiany)
    m_k = min(w_bazowy, m + w_wstawiany)
    for i in range(n_p, n_k):
        for j in range(m_p, m_k):
            if np.all(tab_p_w[i - n, j - m] == tab1[i-n,j-m]):
                tab_bazowy[i, j] = tab_p_w[i - n, j - m]
    return Image.fromarray(tab_bazowy)
#wstaw_inicjaly(beksinski,x,200, 200, [120, 240, 50])


